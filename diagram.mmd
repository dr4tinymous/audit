graph TD
    %% Core data path
    A[Client Application] -->|Publish / Sync / Timeout| B[Bus]
    B -->|Queue| C[Event Queue]
    C -->|Dispatch| D[Worker Pool]
    D -->|Invoke| E[Handlers]

    %% Supporting subsystems
    B -->|Record| F[History Buffer]
    B -->|Spill on Drop| G[Spillover Handler]
    G -->|Write| H[Disk Spillover Log]
    B -->|RecoverSpillover| G

    %% Security and validation
    B -->|Sanitize| I[Sanitizer - email and password]
    B -->|Validate| J[Schema Registry]
    B -->|Encrypt| K[AES Encryption]

    %% Observability
    B -->|Track| L[Prometheus Metrics]
    L -->|Expose| M[Prometheus Server]

    %% Distributed forwarding
    B -->|Forward| N[Kafka Transport]

    %% Logging
    B -->|Emit| O[Logger API]
    O -->|Write| P[Rotated File Log]
    O -->|Batch| Q[Database Writer]

    %% Access control
    F -->|History Access| R[Access Control Func]

    %% Configuration
    S[Environment Config] -->|WithOptions / LoadConfigFromEnv| B
